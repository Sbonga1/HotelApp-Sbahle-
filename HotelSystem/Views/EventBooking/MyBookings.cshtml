@model IEnumerable<HotelSystem.Models.EventBooking>
@{
    ViewBag.Title = "My Event Bookings";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
<div style="padding-top:5%"></div>

<div class="container py-4">
    <h3 class="mb-4"><i class="fa fa-calendar-check me-2"></i> My Events</h3>

    @if (!Model.Any())
    {
        <div class="alert alert-info text-center shadow-sm">
            <i class="fa fa-info-circle me-2"></i> You have not confirmed any event bookings yet.
        </div>
    }
    else
    {
        <div class="row">
            @foreach (var booking in Model)
            {
                var quote = booking.EventQuote;
                var venue = quote?.Venue;
                var isPublic = quote?.EventType.ToString() == "Public";

                var depositStatus = booking.IsPaid ? "Deposit Paid" : "Deposit Pending";
                var badgeColor = booking.IsPaid ? "success" : "warning";
                var paymentAmountText = booking.AmountPaid > 0 ? $" (R {booking.AmountPaid:N2})" : "";

                <div class="col-md-6 mb-4">
                    <div class="card border-0 shadow-lg rounded-4 h-100">
                        <div class="card-body">
                            <h5 class="card-title text-primary fw-bold">
                                <i class="fa fa-map-marker-alt me-2"></i> @(venue?.Name)
                            </h5>

                            <p class="mb-2"><i class="fa fa-calendar-alt me-1"></i> <strong>Start:</strong> @quote.EventStartDateTime.ToString("f")</p>
                            <p class="mb-2"><i class="fa fa-calendar-check me-1"></i> <strong>End:</strong> @quote.EventEndDateTime.ToString("f")</p>
                            <p class="mb-2"><i class="fa fa-users me-1"></i> <strong>Guests:</strong> @quote.GuestCount</p>
                            <p class="mb-2">
                                <i class="fa fa-wallet me-1"></i>
                                <strong>Payment:</strong>
                                <span class="badge bg-@badgeColor px-3 py-1 rounded-pill">
                                    @depositStatus@paymentAmountText
                                </span>
                            </p>

                            <div class="mt-3 d-flex justify-content-end gap-2 flex-wrap">
                                <a href="@Url.Action("Details", "EventBooking", new { id = booking.EventBookingId })" class="btn btn-sm btn-outline-primary">
                                    <i class="fa fa-eye me-1"></i> View Details
                                </a>

                                @if (!booking.IsPaid)
                                {
                                    <a href="@Url.Action("MakePayment", "Payment", new { bookingId = booking.EventBookingId })" class="btn btn-sm btn-success">
                                        <i class="fa fa-credit-card me-1"></i> Pay 50% Deposit
                                    </a>
                                }
                                else if (quote.EventType.ToString() == "Private")
                                {
                                    <a href="@Url.Action("SendRsvp", "EventBooking", new { id = booking.EventBookingId })" class="btn btn-sm btn-outline-secondary">
                                        <i class="fa fa-envelope me-1"></i> Send RSVP
                                    </a>
                                }
                                else if (isPublic)
                                {
                                    <a href="@Url.Action("Index", "Ticket", new { id = booking.EventBookingId })" class="btn btn-sm btn-warning">
                                        <i class="fa fa-ticket-alt me-1"></i> Ticket Types
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>
